// How to use this script?
// Open a new sheet on docs.google.com and use formula like below
// =GOOGLEFINANCE("NSE:TATAMOTORS", "all", TODAY()-366, TODAY(), "daily")
// save as download as csv and replace the value of the variable data.
// The output will be visible on the console like below,
// Change of 2.93% took 2 days from 29/05/2020 till 01/06/2020 with price change from 87 - 89.55

var data = `Date,Open,High,Low,Close,Volume
13/03/2020 15:30:00,61,73.4,61,70,140172
16/03/2020 15:30:00,70,70.6,65.45,66.8,142676
17/03/2020 15:30:00,74.45,74.45,62.15,65.8,190919
18/03/2020 15:30:00,66,67.6,52.65,54.45,199255
19/03/2020 15:30:00,53,53,43.65,46.4,331837
20/03/2020 15:30:00,49.8,49.8,42.7,44.3,223396
23/03/2020 15:30:00,39.9,42.5,39.9,39.9,58295
24/03/2020 15:30:00,41.95,42.6,35.95,36.9,306871
25/03/2020 15:30:00,39.9,39.9,35.65,36.1,145598
26/03/2020 15:30:00,36.5,37.9,34.35,34.85,240803
27/03/2020 15:30:00,35.3,36.55,35.05,36.3,366800
30/03/2020 15:30:00,37.9,38.1,34.85,35.05,1080739
31/03/2020 15:30:00,36,36.8,34.8,35.25,884212
01/04/2020 15:30:00,35.8,37,34.95,36.15,731020
03/04/2020 15:30:00,36.25,37.95,35.5,37.9,178328
07/04/2020 15:30:00,39.7,39.75,38,39.7,214362
08/04/2020 15:30:00,40,41.65,39,41.65,340590
09/04/2020 15:30:00,43.7,43.7,42,42.8,135771
13/04/2020 15:30:00,41.65,44.9,40.7,40.95,299216
15/04/2020 15:30:00,41.9,41.9,40,40.5,676867
16/04/2020 15:30:00,41.75,42.1,40.1,41.6,152227
17/04/2020 15:30:00,43,43.65,42.1,43.6,151262
20/04/2020 15:30:00,45.6,45.75,44.2,45.75,127911
21/04/2020 15:30:00,45.75,48,45.75,47.95,377907
22/04/2020 15:30:00,50,50.3,45.7,48.95,244070
23/04/2020 15:30:00,50.5,50.5,48,50,150923
24/04/2020 15:30:00,49,49,48,48.25,60233
27/04/2020 15:30:00,48.5,49.9,47.5,49.15,100305
28/04/2020 15:30:00,49.9,51.6,48.6,50.85,160122
29/04/2020 15:30:00,51.75,53.35,50.05,53.1,107935
30/04/2020 15:30:00,55.75,55.75,55,55.75,95862
04/05/2020 15:30:00,53,58.5,53,57.85,238303
05/05/2020 15:30:00,59.85,60.45,55,55.05,196150
06/05/2020 15:30:00,55.05,56.75,52.3,53.45,193682
07/05/2020 15:30:00,53.45,55.9,51.5,52.75,77258
08/05/2020 15:30:00,54.7,54.9,52.85,53.15,115964
11/05/2020 15:30:00,54,54,50.5,50.55,166385
12/05/2020 15:30:00,50.55,51,48.05,50.15,202449
13/05/2020 15:30:00,52.65,52.65,48.5,51,257888
14/05/2020 15:30:00,49.9,51.9,48.45,49.65,235047
15/05/2020 15:30:00,49.05,50.65,47.2,49.5,244630
18/05/2020 15:30:00,49.05,49.8,47.05,47.05,110695
19/05/2020 15:30:00,47.7,47.9,44.7,45.35,133356
20/05/2020 15:30:00,43.15,46,43.1,43.1,137914
21/05/2020 15:30:00,42.3,43.1,40.95,40.95,242729
22/05/2020 15:30:00,38.95,42.9,38.95,41.7,997801
26/05/2020 15:30:00,41.7,43.55,41,43.2,493896
27/05/2020 15:30:00,43.3,45.35,41.5,44.75,982284
28/05/2020 15:30:00,45,46.95,45,46.95,3245527
29/05/2020 15:30:00,49.25,49.25,49.25,49.25,1701331
01/06/2020 15:30:00,51.7,51.7,51.7,51.7,28990
02/06/2020 15:30:00,54.25,54.25,53,54.25,867043
03/06/2020 15:30:00,56.95,56.95,56.95,56.95,175716
04/06/2020 15:30:00,57.95,58,54.15,55.15,1332734
05/06/2020 15:30:00,56.6,57.9,55.4,57.9,572169
08/06/2020 15:30:00,60.75,60.75,60.75,60.75,369732
09/06/2020 15:30:00,63.75,63.75,63.75,63.75,1481082
10/06/2020 15:30:00,66.8,66.9,62,62.15,1307515
11/06/2020 15:30:00,62.6,62.65,60,61.5,574821
12/06/2020 15:30:00,58.45,61.35,58.45,60.65,479790
15/06/2020 15:30:00,61.9,61.95,59.1,59.85,168541
16/06/2020 15:30:00,61.95,62.8,60.05,62.8,510080
17/06/2020 15:30:00,64.3,65.9,62,63.7,654504
18/06/2020 15:30:00,63.6,65.5,62,63.2,250606
19/06/2020 15:30:00,65,65,63,63.55,220112
22/06/2020 15:30:00,64.9,65,62.25,63.3,239431
23/06/2020 15:30:00,63,63.45,62.55,63.1,132295
24/06/2020 15:30:00,63.1,64.35,62.75,63,1428278
25/06/2020 15:30:00,62.9,66.15,61.1,63,1593120
26/06/2020 15:30:00,63.1,65.8,60.55,61.65,2445149
29/06/2020 15:30:00,61.5,63.8,60.25,62.15,2044031
30/06/2020 15:30:00,63.95,63.95,62.55,63,630837
01/07/2020 15:30:00,63.65,63.65,61.6,61.95,882223
02/07/2020 15:30:00,61.95,62.9,60.75,61.1,303472
03/07/2020 15:30:00,61.1,62,60.4,60.6,158377
06/07/2020 15:30:00,60.8,63.6,60.75,61,309454
07/07/2020 15:30:00,61.85,62.9,61.05,61.8,525615
08/07/2020 15:30:00,62.45,62.55,61.05,61.15,231140
09/07/2020 15:30:00,60.3,61.8,60.05,61.55,563667
10/07/2020 15:30:00,62,63.6,61.65,63.2,645314
13/07/2020 15:30:00,63.25,65.5,62.15,64.8,496249
14/07/2020 15:30:00,65.45,68,64.35,65.95,698966
15/07/2020 15:30:00,66.5,69.2,64.5,69.05,1127081
16/07/2020 15:30:00,72.45,72.5,70,71.95,940222
17/07/2020 15:30:00,72,72.5,68.4,68.4,371355
20/07/2020 15:30:00,68.65,68.65,65,66.2,295568
21/07/2020 15:30:00,67.7,69.5,67.7,68.5,606385
22/07/2020 15:30:00,69.3,69.3,65.1,67.85,472598
23/07/2020 15:30:00,66.1,68.9,66.1,67.05,107249
24/07/2020 15:30:00,66.8,69.3,66.25,67.6,192080
27/07/2020 15:30:00,68.5,68.8,66.1,66.95,588786
28/07/2020 15:30:00,67.9,67.9,66.25,66.55,323937
29/07/2020 15:30:00,66.95,67.3,65.05,65.4,551712
30/07/2020 15:30:00,66,66,63.7,65.15,255362
31/07/2020 15:30:00,66,66.35,63.75,64.3,327169
03/08/2020 15:30:00,65.05,66.5,64,64.5,542933
04/08/2020 15:30:00,63.5,67.7,63.1,67.7,1470376
05/08/2020 15:30:00,71.05,71.05,71.05,71.05,1041975
06/08/2020 15:30:00,74.6,74.6,68.5,74.6,1688859
07/08/2020 15:30:00,79.5,81.3,75.5,78.75,2128419
10/08/2020 15:30:00,81.5,85.7,79.3,81.95,902551
11/08/2020 15:30:00,82.05,83.4,78.1,79.95,2466389
12/08/2020 15:30:00,82.3,82.3,78,78.3,286631
13/08/2020 15:30:00,78.55,79.35,77,78.65,322347
14/08/2020 15:30:00,79.95,79.95,75.2,76.85,480066
17/08/2020 15:30:00,75.7,78.5,75,77.85,375175
18/08/2020 15:30:00,79.8,79.9,78.15,78.95,218856
19/08/2020 15:30:00,78.5,83.5,78.05,81.7,450739
20/08/2020 15:30:00,81,84.35,80.75,82.25,678646
21/08/2020 15:30:00,83.45,83.5,80.25,82.35,287428
24/08/2020 15:30:00,83.95,85,81.95,83.75,357803
25/08/2020 15:30:00,85,85.9,82,82.7,298969
26/08/2020 15:30:00,82.7,94.3,82.05,91.7,2166045
27/08/2020 15:30:00,92.5,95.85,88.5,90,913148
28/08/2020 15:30:00,91.9,92.35,87.45,88.5,309034
31/08/2020 15:30:00,90.45,92.4,80.1,84.35,706383
01/09/2020 15:30:00,84.35,87.35,67.5,82,424986
02/09/2020 15:30:00,81.7,84.85,81.55,84.05,169040
03/09/2020 15:30:00,84.05,88.3,84,85,165191
04/09/2020 15:30:00,82.25,87,81.2,84.05,1220540
07/09/2020 15:30:00,84.9,86.3,81.1,83.1,209218
08/09/2020 15:30:00,83.8,85.8,81.2,81.8,180641
09/09/2020 15:30:00,80.15,81.75,79.1,81.05,272029
10/09/2020 15:30:00,81.1,85.65,81.1,85.05,288817
11/09/2020 15:30:00,84.85,91.75,83.5,88.9,492199
14/09/2020 15:30:00,90,106.65,90,99.8,4213806
15/09/2020 15:30:00,103.7,103.7,96.5,99.1,1015194
16/09/2020 15:30:00,99.8,99.85,96.05,97.35,558713
17/09/2020 15:30:00,97.95,106.5,96.35,104.5,3118774
18/09/2020 15:30:00,106,114.5,100,107.7,3336103
21/09/2020 15:30:00,108.75,118.5,102.1,103.9,2867267
22/09/2020 15:30:00,105.35,113.3,99,107.1,2704819
23/09/2020 15:30:00,109.9,115.8,109.15,112.55,2196822
24/09/2020 15:30:00,112.5,115.45,107.2,111,1631688
25/09/2020 15:30:00,113,115.15,110.15,111.35,879173
28/09/2020 15:30:00,113.6,113.65,110.4,111.1,587730
29/09/2020 15:30:00,111.9,118.75,109.1,116.2,1281272
30/09/2020 15:30:00,119.3,127,117.7,122.35,3795983
01/10/2020 15:30:00,124.8,126,121,124.45,1020906
05/10/2020 15:30:00,126.7,129.7,120.1,122.15,2146062
06/10/2020 15:30:00,122.85,123.1,120,120.5,580007
07/10/2020 15:30:00,121.6,121.6,114.1,116.35,757405
08/10/2020 15:30:00,119.3,125.9,116.9,119.85,1577896
09/10/2020 15:30:00,120.5,121.65,115.2,116,547938
12/10/2020 15:30:00,116.8,118.2,111.1,113.4,641960
13/10/2020 15:30:00,113.8,123.4,111.55,119.3,2195623
14/10/2020 15:30:00,119.95,119.95,114.95,116.25,593649
15/10/2020 15:30:00,116.5,121,111.1,112.35,853481
16/10/2020 15:30:00,113.05,115,107.65,110.65,691017
19/10/2020 15:30:00,111.7,114.65,110.1,114.15,416736
20/10/2020 15:30:00,114.15,116.4,112,112.95,460104
21/10/2020 15:30:00,113.95,114.3,110.1,111.5,388861
22/10/2020 15:30:00,110,110.45,104.2,105.65,1417852
23/10/2020 15:30:00,106,107,103.75,105.4,572922
26/10/2020 15:30:00,105.9,106.55,100.3,101.25,492491
27/10/2020 15:30:00,101.2,102.35,96.4,99.1,738686
28/10/2020 15:30:00,97.6,101.6,97.4,97.8,330118
29/10/2020 15:30:00,97.8,98.85,94.5,94.9,345091
30/10/2020 15:30:00,95.05,99.65,93.2,94.2,1070363
02/11/2020 15:30:00,94.5,94.9,89.75,90.75,576288
03/11/2020 15:30:00,91.3,95.3,91.1,94.1,465637
04/11/2020 15:30:00,95.9,98,94.1,96.25,366516
05/11/2020 15:30:00,98.6,98.9,96.35,97.35,294935
06/11/2020 15:30:00,98,98,95.15,95.5,228694
09/11/2020 15:30:00,97,98,96.1,97,239919
10/11/2020 15:30:00,98,98,92.8,94.45,349979
11/11/2020 15:30:00,100,102,96.2,97.35,1680402
12/11/2020 15:30:00,98.85,99.7,97.55,98.05,334232
13/11/2020 15:30:00,98.55,103.5,96.7,102.35,2102959
17/11/2020 15:30:00,105.8,108.4,103,107.6,803392
18/11/2020 15:30:00,107.95,108,103.25,104,333405
19/11/2020 15:30:00,104,105.85,102.2,104,335137
20/11/2020 15:30:00,103.8,106.65,103,104.2,263265
23/11/2020 15:30:00,104.2,107.7,103.9,105.85,391822
24/11/2020 15:30:00,106.9,106.9,104.55,105.55,218222
25/11/2020 15:30:00,106.6,107,101.5,101.9,388033
26/11/2020 15:30:00,102,102.95,99.4,101.7,371155
27/11/2020 15:30:00,102,107.5,101.65,106.9,578251
01/12/2020 15:30:00,107.7,111,106.35,108.9,590141
02/12/2020 15:30:00,109.8,110.8,107,108.5,271766
03/12/2020 15:30:00,108.5,110.4,106.8,107.4,260403
04/12/2020 15:30:00,108,109.7,104.2,108.1,489407
07/12/2020 15:30:00,110.7,115.15,109.2,114,998523
08/12/2020 15:30:00,116,118.5,109.25,110.6,1183096
09/12/2020 15:30:00,111.1,114.3,111.1,112.55,429166
10/12/2020 15:30:00,112.55,112.75,107.3,107.7,477553
11/12/2020 15:30:00,108.05,111,107.6,108.3,375057
14/12/2020 15:30:00,110.6,113.95,110.1,111,362789
15/12/2020 15:30:00,111.6,111.6,108.05,110.1,280070
16/12/2020 15:30:00,110.5,115.7,109.35,114.05,1664792
17/12/2020 15:30:00,114.7,118.5,108.9,111.45,1557305
18/12/2020 15:30:00,112.3,121.45,110.2,119.65,3698887
21/12/2020 15:30:00,119,124.4,104.35,106.9,2818415
22/12/2020 15:30:00,108,123.45,105.5,120.55,3443451
23/12/2020 15:30:00,123.9,126.6,118.7,122.3,3460088
24/12/2020 15:30:00,122.95,123.7,118,119.2,1378861
28/12/2020 15:30:00,120,133.4,119.3,130.15,4486662
29/12/2020 15:30:00,133.9,135.7,126.6,131.5,2732053
30/12/2020 15:30:00,131.1,137.7,128,134.15,2967113
31/12/2020 15:30:00,132.6,144.3,132.6,142,4016021
01/01/2021 15:30:00,141.1,148.65,141.1,143.9,2734406
04/01/2021 15:30:00,145.2,148,142.85,145.45,2237108
05/01/2021 15:30:00,142.85,147,141.3,144.1,1376388
06/01/2021 15:30:00,144.25,145.45,133.3,136.4,1817053
07/01/2021 15:30:00,138,142,134.1,135.3,775346
08/01/2021 15:30:00,136.4,140.5,133.1,139.8,1226824
11/01/2021 15:30:00,142.05,142.4,136,136.65,723765
12/01/2021 15:30:00,137.2,137.3,132.4,135.6,451271
13/01/2021 15:30:00,136,138.8,133,134.9,714528
14/01/2021 15:30:00,136.15,136.6,130.7,134.1,469381
15/01/2021 15:30:00,134.2,139.5,133.5,135.55,817322
18/01/2021 15:30:00,136.35,137.65,131.2,132.15,532034
19/01/2021 15:30:00,134.45,142.4,134.45,139.85,1297616
20/01/2021 15:30:00,140.5,143.9,137.6,141.35,1247608
21/01/2021 15:30:00,142.45,142.6,138,139.3,677450
22/01/2021 15:30:00,139,139.95,134.1,135.1,425337
25/01/2021 15:30:00,136.2,137.05,126.8,133.65,813436
27/01/2021 15:30:00,134.5,139.7,130.85,136.1,591758
28/01/2021 15:30:00,135,136.5,132,132.95,438527
29/01/2021 15:30:00,137,145,134.8,142.8,3405591
01/02/2021 15:30:00,142.5,142.7,132,137.9,1632716
02/02/2021 15:30:00,140.6,141.15,134.3,134.95,825683
03/02/2021 15:30:00,136.9,137.65,134.4,135.4,810617
04/02/2021 15:30:00,136.2,137.95,135.2,136.5,665122
05/02/2021 15:30:00,136.1,139.9,132.1,132.65,847117
08/02/2021 15:30:00,134,139.7,133.3,138.6,1051028
09/02/2021 15:30:00,139.5,139.5,130.1,136.8,953248
10/02/2021 15:30:00,138,138.15,134.5,135.25,757841
11/02/2021 15:30:00,135.9,135.95,133.45,134.45,357201
12/02/2021 15:30:00,135.15,136.5,133.55,135.65,520110
15/02/2021 15:30:00,135,136.8,133.25,134.35,355705
16/02/2021 15:30:00,133.55,135.05,131.1,131.8,435811
17/02/2021 15:30:00,132.4,135.7,130.1,133.1,496792
18/02/2021 15:30:00,133.8,135.45,131.15,132.45,355391
19/02/2021 15:30:00,133.35,134.9,131.3,133.55,427228
22/02/2021 15:30:00,135.65,135.65,130.25,131.8,692091
23/02/2021 15:30:00,132.5,141.65,130.5,137.35,929491
24/02/2021 15:30:00,137.35,144.9,136.05,142.1,1144061
25/02/2021 15:30:00,143.45,150,139.4,146.7,1226980
26/02/2021 15:30:00,142.15,147.9,141.45,144.6,796540
01/03/2021 15:30:00,147,147.35,141.9,142.5,365330
02/03/2021 15:30:00,142.5,144.55,141.1,141.7,370431
03/03/2021 15:30:00,142.7,143,140.1,141.4,741315
04/03/2021 15:30:00,141.4,142.75,140,140.3,863274
05/03/2021 15:30:00,140.35,141.8,135.2,138,591713
08/03/2021 15:30:00,139,148.5,138.75,145.2,2451558
09/03/2021 15:30:00,147,169.6,146.25,161.7,5176733
10/03/2021 15:30:00,170.45,174,155,159.65,12204967
12/03/2021 15:30:00,159.8,160.85,155.05,157.1,2819710`;

function getAsJSON(data) {
  var lines = data.split("\n");
  var keys = [];
  var rows = [];
  for (var i = 0; i < lines.length; i++) {
    var tokens = lines[i].split(",");
    if (i === 0) {
      keys = tokens;
      continue;
    }

    var row = {};
    for (let k = 0; k < tokens.length; k++) {
      row[keys[k]] = tokens[k];
    }
    rows.push(row);
  }

  return rows;
}

// How long does it take to reach the percentage of profit given?
function getTimetakenForProfitPercentageFromAnyDay(data, percent) {
  var dataObjs = getAsJSON(data);
  // Loop to start from each day of given set.
  for (let i = 0; i < dataObjs.length; i++) {
    // Inner loop to calculate the percentage from a start day
    // till a specific day till it hits the change expected.
    for (let j = i; j < dataObjs.length; j++) {
      let prevOpen = Number(dataObjs[i].Open);
      let currClose = Number(dataObjs[j].Close);
      let change = ((currClose - prevOpen) / prevOpen) * 100;
      if (change >= percent) {
        // Expected loss between the percentage chagne.
        // Min of open or close price between the
        // percentage change.
        let min = prevOpen;
        for (let m = i; m < j; m++) {
          let currMinOpen = Number(dataObjs[m].Open);
          if (currMinOpen < min) {
            min = currMinOpen;
          }
          let currMinClose = Number(dataObjs[m].Close);
          if (currMinClose < min) {
            min = currMinClose;
          }
        }

        let lossPercentage = ((prevOpen - min) / prevOpen) * 100;

        let days = j - i;
        console.log(
          "Profit of",
          change.toFixed(2) + "%",
          "took",
          days,
          "trading days",
          "from",
          dataObjs[i].Date.split(" ")[0],
          "till",
          dataObjs[j].Date.split(" ")[0],
          "with price change from",
          prevOpen,
          "to",
          currClose,
          "with max unrealized loss of",
          lossPercentage.toFixed(2) + "% -",
          min
        );
        break;
      }
    }
  }
}

getTimetakenForProfitPercentageFromAnyDay(data, 1);
